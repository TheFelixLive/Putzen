<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Person-Zuordnung basierend auf Unix-Zeit und Woche</title>
  <script>
    // Listen von Personen und Räumen
    const personen = ['person_0', 'person_1', 'person_2', 'person_3', 'person_4'];
    const raeume = ['room_0', 'room_1', 'room_2', 'room_3', 'room_4'];

    // Berechnet die Kalenderwoche basierend auf dem Datum
    function getISOWeek(date) {
        const tempDate = new Date(date.getTime());
        tempDate.setDate(tempDate.getDate() - tempDate.getDay() + 1); // Setze auf den ersten Montag
        const firstMonday = new Date(tempDate.getFullYear(), 0, 1);
        const dayOfYear = Math.floor((tempDate - firstMonday) / (1000 * 3600 * 24));
        return Math.floor(dayOfYear / 7) + 1;
    }

    // Berechnet die Person basierend auf dem aktuellen Datum und der Woche
    function getPersonBasedOnTimeAndRoom(room) {
        const unixTimestamp = Math.floor(Date.now() / 1000);  // Unix-Zeit in Sekunden
        const date = new Date(unixTimestamp * 1000);  // Unix-Zeitstempel in Datum umwandeln
        const currentWeek = getISOWeek(date);  // Korrekte Kalenderwoche berechnen
        const roomIndex = raeume.indexOf(room);  // Finde den Index des Raums in der Liste
        const personIndex = (roomIndex + currentWeek) % personen.length;  // Berechne den Person-Index je nach Woche

        return personen[personIndex];
    }

    // Berechnet die Zeit bis zur nächsten Änderung
    function getTimeUntilNextChange(finished) {
        const now = new Date();
        const monday12_20 = new Date(now);
        const friday09_00 = new Date(now);

        // Setze Montag auf 12:20
        monday12_20.setDate(now.getDate() - now.getDay() + 1);  // Nächsten Montag
        monday12_20.setHours(12, 20, 0, 0);

        // Setze Freitag auf 09:00
        friday09_00.setDate(now.getDate() + (5 - now.getDay() + 7) % 7);  // Nächsten Freitag
        friday09_00.setHours(9, 0, 0, 0);

        let output = "";
        
        if (finished === 1) {
            // Berechne Zeit bis Freitag 9:00 Uhr
            if (now < friday09_00) {
                const timeDiff = friday09_00 - now;
                const { days, hours, minutes, seconds } = getTimeDetails(timeDiff);
                output = `Zeit bis zur Übersetzung: ${days} Tage(n), ${hours} Stunde(n), ${minutes} Minute(n) und ${seconds} Sekunde(n).`;
            } else {
                output = "Die Übersetzung wurde bereits durchgeführt.";
            }
        } else if (finished === 0) {
            // Berechne Zeit seit Montag 12:20 Uhr
            if (now >= monday12_20 && now < friday09_00) {
                const timeDiff = now - monday12_20;
                const { days, hours, minutes, seconds } = getTimeDetails(timeDiff);
                output = `Du bist zu spät: ${days} Tage(n), ${hours} Stunde(n), ${minutes} Minute(n) und ${seconds} Sekunde(n) seit Montag, 12:20 Uhr.`;
            } else {
                output = "Es ist noch nicht zu spät.";
            }
        } else {
            // Berechne Zeit bis Montag 12:20 Uhr (Freitag 9:00 bis Montag 12:20)
            if (now >= friday09_00) {
                const timeDiff = monday12_20 - now;
                const { days, hours, minutes, seconds } = getTimeDetails(timeDiff);
                output = `Verbleibende Zeit: ${days} Tage(n), ${hours} Stunde(n), ${minutes} Minute(n) und ${seconds} Sekunde(n) bis Montag, 12:20 Uhr.`;
            } else {
                output = "Noch nicht im Zeitraum zwischen Freitag und Montag.";
            }
        }

        return output;
    }

    // Hilfsfunktion, um die Zeitdifferenz in Tagen, Stunden, Minuten und Sekunden zu berechnen
    function getTimeDetails(timeDiff) {
        const days = Math.floor(timeDiff / (1000 * 3600 * 24));
        const hours = Math.floor((timeDiff % (1000 * 3600 * 24)) / (1000 * 3600));
        const minutes = Math.floor((timeDiff % (1000 * 3600)) / (1000 * 60));
        const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
        return { days, hours, minutes, seconds };
    }

    // Funktion für die manuelle Eingabe eines Raums
    function handleRoomInput() {
      const roomInput = document.getElementById("roomInput").value;
      const finished = parseInt(document.getElementById("finishedInput").value); // Nimmt den "finished"-Parameter
      if (raeume.includes(roomInput)) {
        const person = getPersonBasedOnTimeAndRoom(roomInput);
        const timeMessage = getTimeUntilNextChange(finished);
        
        document.getElementById("output").innerText = `${timeMessage}\nZugewiesene Person für ${roomInput}: ${person}`;
      } else {
        document.getElementById("output").innerText = "Ungültiger Raum!";
      }
    }
  </script>
</head>
<body>
  <h1>Person-Zuordnung basierend auf Unix-Zeit und Kalenderwoche</h1>

  <label for="roomInput">Raum auswählen:</label>
  <input type="text" id="roomInput" placeholder="room_0 bis room_4" />
  <label for="finishedInput">Fertig (finished):</label>
  <input type="number" id="finishedInput" min="0" max="1" placeholder="0 oder 1" />
  <button onclick="handleRoomInput()">Person anzeigen</button>

  <p id="output"></p>

</body>
</html>
